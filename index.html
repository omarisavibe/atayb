<!DOCTYPE html>
<html lang="ar-EG" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>أطايب الواحات - تمور فاخرة لكل مناسبة</title> {/* Changed title slightly */}
    <link rel="icon" href="atyab-logo-gold.png" type="image/png">

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;700;800&family=Marhey:wght@400;600;700&display=swap" rel="stylesheet">

    <link rel="stylesheet" href="style.css">

    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin=""/>
    <link rel="stylesheet" href="https://unpkg.com/leaflet-control-geocoder/dist/Control.Geocoder.css" />

    <meta name="description" content="اكتشف أفخر أنواع تمور الواحات الطبيعية من أطايب الواحات. جودة لا مثيل لها، توصيل سريع في القاهرة والجيزة.">
    <style>
        /* ... (existing styles from your <style> block) ... */

        /* NEW STYLES FOR VISUAL SIZE SELECTION */
        .size-selection-visual-options {
            display: flex;
            flex-wrap: wrap;
            gap: 25px; /* Increased gap */
            justify-content: center;
            margin-bottom: 2rem;
        }
        .size-option-card {
            background-color: var(--surface-color);
            border: 2px solid var(--brand-gold-transparent);
            border-radius: var(--radius-large);
            padding: 20px;
            width: 220px; /* Adjust as needed */
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            flex-direction: column;
            align-items: center;
            box-shadow: 0 4px 10px rgba(0,0,0,0.2);
        }
        .size-option-card:hover, .size-option-card.selected {
            border-color: var(--brand-gold);
            background-color: rgba(218, 165, 32, 0.1); /* Subtle gold tint on hover/select */
            transform: translateY(-5px) scale(1.03);
            box-shadow: 0 8px 20px var(--brand-gold-transparent);
        }
        .size-option-card img {
            width: 150px; /* Adjust as needed */
            height: 120px; /* Adjust as needed */
            object-fit: contain; /* Use contain to ensure full image is visible */
            margin-bottom: 15px;
            border-radius: var(--radius-medium);
            /* background-color: #444; /* Optional placeholder bg */
        }
        .size-option-card h3 {
            font-family: var(--font-display);
            color: var(--brand-gold-light);
            font-size: 1.5rem;
            margin-bottom: 8px;
        }
        .size-option-card p.size-description {
            font-size: 0.9rem;
            color: var(--text-grey-light);
            line-height: 1.4;
        }

        /* Override for option-button if it was used elsewhere, or ensure .size-option-card has priority */
        .selection-options .option-button { /* Original text buttons for weight */
            font-family: 'Tajawal', sans-serif;
            background-color: transparent;
            color: var(--brand-gold);
            border: 2px solid var(--brand-gold);
            padding: 15px 30px;
            font-size: 1.3rem;
            font-weight: 700;
            border-radius: var(--radius-medium);
            cursor: pointer;
            transition: all 0.3s ease;
            min-width: 180px;
        }
        .selection-options .option-button:hover, .selection-options .option-button.selected {
            background-color: var(--brand-gold);
            color: var(--background-dark);
            box-shadow: 0 0 15px var(--brand-gold-transparent);
        }
    </style>
</head>
<body class="dark-theme">

    <header class="site-header">
        <div class="container header-container">
            <div class="logo-area">
                <img src="atyab-logo-gold.png" alt="شعار أطايب الواحات" class="logo-main">
            </div>
            <nav class="main-nav" aria-label="القائمة الرئيسية">
                <a href="#how-to-order" class="nav-link">كيفية الطلب</a>
                <a href="#about-us" class="nav-link">عن تمورنا</a>
            </nav>
            <button id="cart-button" class="cart-toggle-button button-style-primary">
                🛒 سلتك (<span id="cart-count">0</span>)
            </button>
            <button class="mobile-menu-toggle" aria-label="فتح/إغلاق القائمة">☰</button>
        </div>
    </header>

    <main>
        <!-- Screen 1: Choose Date Size (MODIFIED) -->
        <section id="date-size-selection-screen" class="selection-screen active-screen" style="background-image: url('gold-ripple-background.jpg'); background-size: cover; background-position: center;">
            <h1 class="selection-title">أطايب الواحات</h1>
            <p class="selection-subtitle">رحلة الطعم تبدأ بحجمك المفضل. اختر من كنوز الواحات.</p>
            <div class="size-selection-visual-options">
                <!-- ** IMAGE PROMPT: wahat_dates_small_visual.png **
                Design: Clean visual of several small "Wahat Dates".
                Dates: 5-7 small, plump, semi-dry Wahat dates, neatly arranged.
                Background: Light, neutral, slightly textured (e.g., light wood, off-white).
                Lighting: Bright, natural. Mood: Fresh, natural, clearly "small".
                Output: PNG with transparent or matching light background.
                -->
                <div class="size-option-card" data-size="صغير">
                    <img src="wahat_dates_small_visual.png" alt="تمور الواحات بحجم صغير">
                    <h3>صغير</h3>
                    <p class="size-description">مظهر طبيعي، مثالي للتمتع اليومي.</p>
                </div>

                <!-- ** IMAGE PROMPT: wahat_dates_medium_visual.png **
                Design: Clean visual of several medium "Wahat Dates".
                Dates: 4-6 medium-sized Wahat dates, appearing robust.
                Background & Lighting: Consistent with "small" visual.
                Mood: Wholesome, satisfying, clearly "medium".
                Output: PNG with transparent or matching light background.
                -->
                <div class="size-option-card" data-size="وسط">
                    <img src="wahat_dates_medium_visual.png" alt="تمور الواحات بحجم متوسط">
                    <h3>وسط</h3>
                    <p class="size-description">قوام متوازن، لطعم غني وأصيل.</p>
                </div>

                <!-- ** IMAGE PROMPT: wahat_dates_jumbo_visual.png **
                Design: Clean visual of few jumbo "Wahat Dates".
                Dates: 2-4 jumbo-sized Wahat dates, looking impressively large.
                Background & Lighting: Consistent with other visuals.
                Mood: فاخر، مميز، بوضوح "چامبو".
                Output: PNG with transparent or matching light background.
                -->
                <div class="size-option-card" data-size="چامبو">
                    <img src="wahat_dates_jumbo_visual.png" alt="تمور الواحات بحجم چامبو">
                    <h3>چامبو</h3>
                    <p class="size-description">حجم ملكي، لتجربة لا تُنسى.</p>
                </div>
            </div>
            <p class="info-text" style="color: var(--text-grey-light); margin-top: 2rem; background-color: rgba(0,0,0,0.5); padding: 10px; border-radius: var(--radius-small);">تمور الواحات طبيعية ١٠٠٪، مختارة بحب من قلب الطبيعة المصرية الخصبة.</p>
        </section>

        <!-- Screen 2: Choose Pack Weight -->
        <section id="pack-weight-selection-screen" class="selection-screen" style="display: none;">
            <h2 class="selection-title">اختر وزن العبوة</h2>
            <p class="selection-subtitle">تمور الواحات <span id="selected-date-size-display"></span>: جوهر الفخامة في كل حبة.</p>
            <div class="selection-options"> {/* Kept original class for weight buttons styling consistency */}
                <button class="option-button" data-weight="400">عبوة ٤٠٠ جم</button>
                <button class="option-button" data-weight="800">عبوة ٨٠٠ جم</button>
            </div>
            <button id="back-to-size-selection" class="cta-button button-style-secondary" style="margin-top: 2rem;">العودة لاختيار الحجم</button>
        </section>

        <!-- Screen 3: Product Display & Add to Cart -->
        <section id="product-display-screen" class="product-display-area" style="display: none;">
            <h2 class="selection-title">اختيارك من تمور الواحات</h2>
            <p class="selection-subtitle" id="final-product-selection-info">الآن، أضف كنوز الواحات إلى سلتك.</p>
            <div id="product-grid" class="product-grid">
                 <p class="loading-msg" id="loading-indicator" style="display: none;">لحظات من فضلك، نجلب لك أطايب الواحات...</p>
            </div>
             <button id="back-to-weight-selection" class="cta-button button-style-secondary" style="margin-top: 2rem;">العودة لاختيار الوزن</button>
        </section>


        <section id="how-to-order" class="info-section container">
            <h2 class="section-title">خطوات بسيطة لطلب كنوز الواحات</h2>
            <ol class="steps-list">
                <li>اختر حجم التمر الذي يروق لك من بين (صغير، وسط، أو چامبو).</li>
                <li>حدد وزن العبوة المناسب لاحتياجك (٤٠٠ جم أو ٨٠٠ جم).</li>
                <li>استعرض أصناف تمور الواحات المتاحة وأضفها لسلتك بكبسة زر.</li>
                <li>أتمم بيانات التوصيل، حدد موقعك بدقة على الخريطة، واختر طريقة الدفع المفضلة.</li>
                <li>انتظر وصول أطايب الواحات الطازجة إلى عتبة دارك!</li>
            </ol>
        </section>

        <section id="about-us" class="info-section dark-section">
            <div class="container">
            <h2 class="section-title">عن أطايب الواحات</h2>
            <p class="section-subtitle">في "أطايب الواحات"، نعتز بتقديم تمور طبيعية فائقة الجودة، هي خلاصة خيرات الواحات المصرية العريقة. كل تمرة نختارها هي قصة من عناية فائقة والتزام بالمعايير العضوية، لنضمن لك منتجًا طبيعيًا نقيًا، يثري تجربتك بمذاق أصيل وفوائد لا تُحصى.</p>
            <p>سواء كنت تنشد طاقة طبيعية ليومك، أو تبحث عن هدية تعبر عن الذوق الرفيع، أو ترغب في إضافة لمسة صحية راقية لمائدتك، فإن تمور "أطايب الواحات" هي وجهتك المثالية. نقدم لك تشكيلة فريدة تلبي كافة التطلعات، مع تعهدنا الثابت بالجودة الفائقة، من قلب الواحة إليك مباشرة.</p>
            <img src="premium-dates-assortment.jpg" alt="تشكيلة من تمور أطايب الواحات الفاخرة" class="info-image" style="max-width: 400px; margin: 1.5rem auto; border-radius: var(--radius-medium); border: 2px solid var(--brand-gold-transparent);">
            </div>
        </section>

    </main>

    <footer class="site-footer">
        <div class="container">
            <p class="copyright">© <span id="year">2024</span> أطايب الواحات. كل الحقوق محفوظة.</p>
            <p class="footer-tagline">تمور طبيعية فاخرة، من قلب الواحة إليك.</p>
             <a href="admin-login.html" class="admin-secret-link" target="_blank" title="Admin Zone">👨‍💻</a>
        </div>
    </footer>

    <!-- Cart Sidebar & Overlay -->
    <div id="cart-overlay" class="cart-overlay"></div>
    <div id="cart-sidebar" class="cart-sidebar">
        <button id="close-cart-button" class="close-modal-button" aria-label="إغلاق السلة">×</button>
        <h2 class="sidebar-title">سلة أطايبك</h2>
        <div id="cart-items" class="cart-items-container">
            <p class="cart-empty-message">سلتك تنتظر أطايب الواحات. ابدأ رحلة الاختيار!</p>
        </div>
        <div class="cart-summary-section">
            <p class="cart-total-text">الإجمالي: <span id="cart-total-price">٠٫٠٠ ج.م</span></p>
            <button id="checkout-button" class="cta-button checkout-btn" disabled>إتمام الطلب والدفع</button>
        </div>
    </div>

    <!-- Checkout Modal & Overlay -->
    <div id="checkout-overlay" class="checkout-overlay">
        <div id="checkout-modal" class="checkout-modal">
            <button id="close-checkout-button" class="close-modal-button" aria-label="إغلاق نافذة الطلب">×</button>
            <h2 class="modal-title">تفاصيل التوصيل والدفع</h2>
            {/* ... Rest of the checkout form is the same ... */}
            <form id="checkout-form" novalidate>
                <div class="form-group">
                    <label for="customer_name">الاسم الكريم:</label>
                    <input type="text" id="customer_name" name="customer_name" placeholder="الاسم ثنائي أو ثلاثي" required>
                </div>

                <div class="form-group">
                    <label for="customer_phone">رقم الهاتف:</label>
                    <input type="tel" id="customer_phone" name="customer_phone" placeholder="٠١XXXXXXXXX" required pattern="^01[0-2,5]{1}[0-9]{8}$">
                    <small class="form-hint">ضروري للتواصل وتأكيد التوصيل بكفاءة.</small>
                </div>

                <div class="form-group">
                     <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.5rem; flex-wrap: wrap; gap: 10px;">
                        <label for="map-container" style="margin-bottom: 0;">موقع التوصيل (حدد بدقة على الخريطة أو ابحث):</label>
                        <button type="button" id="find-me-button" class="button-style-secondary small-button" title="تحديد موقعي الحالي">
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" width="16" height="16" style="vertical-align: middle; margin-left: 4px;"><path d="M12 8c-2.21 0-4 1.79-4 4s1.79 4 4 4 4-1.79 4-4-1.79-4-4-4zm8.94 3A8.994 8.994 0 0 0 13 3.06V1h-2v2.06A8.994 8.994 0 0 0 3.06 11H1v2h2.06A8.994 8.994 0 0 0 11 20.94V23h2v-2.06A8.994 8.994 0 0 0 20.94 13H23v-2h-2.06zM12 19c-3.87 0-7-3.13-7-7s3.13-7 7-7 7 3.13 7 7-3.13 7-7 7z"/></svg>
                             حدد موقعي الآن
                        </button>
                    </div>
                    <p style="font-size: 0.85em; margin-bottom: 0.5rem; color: var(--text-grey-light);">
                        نصيحة: استخدم عرض القمر الصناعي (أعلى يمين الخريطة) لرؤية واضحة للمباني! انقر على الخريطة، ابحث عن عنوانك، أو استخدم 'حدد موقعي الآن'.
                        <strong style="color: var(--brand-gold-light); display: block; margin-top: 3px;">📍 خدمة التوصيل متاحة حاليًا في <strong style="text-decoration: underline;">القاهرة الكبرى</strong> و<strong style="text-decoration: underline;">محافظة الجيزة</strong>.</strong>
                    </p>
                    <div id="map-container" class="map-container" style="height: 300px; width: 100%; margin-bottom: 1rem; border: 1px solid var(--brand-gold-transparent); border-radius: var(--radius-small); background-color: #333; position: relative;">
                        <p style="text-align:center; padding-top: 50px; color: #888; position: absolute; top: 0; right: 0; width: 100%; z-index: 0;">جاري تهيئة الخريطة التفاعلية...</p>
                    </div>
                    <p id="location-status" class="status-pending" style="text-align: center; font-weight: bold; min-height: 1.5em; margin-bottom: 1rem;">نرجو تحديد موقعكم على الخريطة أو البحث عن العنوان.</p>
                    <input type="hidden" id="customer_latitude" name="customer_latitude" required>
                    <input type="hidden" id="customer_longitude" name="customer_longitude" required>
                </div>

                <div class="form-group address-details-group">
                    <h4 style="margin-bottom: 0.75rem; font-size: 1rem; color: var(--brand-gold-light);">تفاصيل إضافية لعنوان التوصيل (اختياري ولكن يسرع وصول طلبك):</h4>
                    <label for="building_details">اسم/رقم المبنى/الفيلا:</label>
                    <input type="text" id="building_details" name="building_details" placeholder="مثال: فيلا ١٢٣، عمارة الأمل رقم ٧أ">
                    <label for="floor_apt">رقم الدور والشقة (إن وجد):</label>
                    <input type="text" id="floor_apt" name="floor_apt" placeholder="مثال: الدور الثالث، شقة رقم ٣٠٢">
                    <label for="landmarks">أقرب علامات مميزة / ملاحظات لمندوب التوصيل:</label>
                    <input type="text" id="landmarks" name="landmarks" placeholder="مثال: بجوار مسجد النور، يرجى الاتصال قبل الوصول بـ ١٠ دقائق">
                </div>

                <div class="checkout-summary-box">
                    <h4 class="summary-title" style="font-size: 1.1rem; margin-bottom: 0.5rem;">ملخص طلبكم الكريم:</h4>
                    <div id="checkout-summary" style="max-height: 80px; overflow-y: auto;">
                        <p style="font-style: italic; color: var(--text-grey-light); font-size: 0.9rem;">محتويات السلة ستظهر هنا فور إضافتها...</p>
                    </div>
                    <p class="total-title" style="margin-top: 0.5rem; font-size: 1.2rem;">الإجمالي المستحق: <span id="checkout-total-price">٠٫٠٠ ج.م</span></p>
                </div>
                
                 <div class="telda-payment-instructions">
                    <img src="telda-logo-dark.png" alt="شعار تلدا" class="telda-logo">
                    <h4>الدفع الآمن عبر Telda (اختياري)</h4>
                    <p>يمكنكم إرسال إجمالي المبلغ (<span id="telda-total-price-reminder" class="payment-total-reminder">٠٫٠٠ ج.م</span>) عبر تطبيق تلدا إلى الحساب:</p>
                    <p class="telda-username-wrapper">
                        <span class="telda-username">@AtyabElThamar</span> <!-- EXAMPLE USERNAME -->
                    </p>
                </div>

                <div class="instapay-payment-instructions">
                    <img src="instapay-logo-dark.png" alt="شعار إنستاباي" class="instapay-logo">
                    <h4>الدفع الفوري عبر InstaPay (اختياري)</h4>
                    <p>أو تفضلوا بإرسال إجمالي المبلغ (<span id="instapay-total-price-reminder" class="payment-total-reminder">٠٫٠٠ ج.م</span>) عبر تطبيق إنستاباي إلى:</p>
                    <div class="copyable-detail">
                        <label>رقم الحساب/الهاتف:</label>
                        <span class="instapay-detail" id="instapay-account">01xxxxxxxxx / اسم الحساب الرسمي</span>
                        <button type="button" class="copy-button" data-clipboard-target="#instapay-account" aria-label="نسخ رقم الحساب">📋 نسخ البيانات</button>
                    </div>
                </div>

                <div class="form-group payment-method-selection">
                    <label>الرجاء اختيار طريقة الدفع التي تفضلونها:*</label>
                    <div class="payment-method-options">
                        <div>
                            <input type="radio" id="payment-method-telda" name="payment_method" value="Telda" required>
                            <label for="payment-method-telda">Telda</label>
                        </div>
                        <div>
                            <input type="radio" id="payment-method-instapay" name="payment_method" value="Instapay" required>
                            <label for="payment-method-instapay">InstaPay</label>
                        </div>
                        <div>
                            <input type="radio" id="payment-method-cash" name="payment_method" value="CashOnDelivery" required>
                            <label for="payment-method-cash">الدفع نقداً عند الاستلام</label>
                        </div>
                    </div>
                </div>

                <button type="submit" id="submit-order-button" class="cta-button submit-btn">تأكيد الطلب وإرسال التفاصيل النهائية</button>
                <p id="checkout-message" class="checkout-message"></p>
            </form>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>
    <script src="https://unpkg.com/leaflet-control-geocoder/dist/Control.Geocoder.js"></script>
    <script src="script.js"></script>
</body>
</html>
