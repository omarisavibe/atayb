<!DOCTYPE html>
<html lang="ar-EG" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>أطيب الثمر - تمور فاخرة لكل مناسبة</title>
    <link rel="icon" href="atyab-logo-gold.png" type="image/png"> <!-- You'll need to create this logo -->

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <!-- Choose premium Arabic fonts. Examples: Tajawal, Cairo, Almarai, Scheherazade New for body, a more display font for headers -->
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;700;800&family=Marhey:wght@400;600;700&display=swap" rel="stylesheet">

    <link rel="stylesheet" href="style.css">

    <!-- Leaflet Map CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin=""/>
    <link rel="stylesheet" href="https://unpkg.com/leaflet-control-geocoder/dist/Control.Geocoder.css" />

    <meta name="description" content="اكتشف أفخر أنواع التمور الطبيعية العضوية من أطيب الثمر. جودة لا مثيل لها، توصيل سريع في القاهرة والجيزة.">
    <style>
        /* Additional critical styles, mostly from VibeTreats but themed */
        #location-status.status-ok { color: #4CAF50; /* Green */}
        #location-status.status-error { color: #f44336; /* Red */ }
        #location-status.status-pending { color: #757575; /* Grey */ }
        .map-container.input-error { border-color: #f44336; }

        .address-details-group {
            padding: 10px;
            background-color: rgba(218, 165, 32, 0.05); /* Very light gold tint */
            border: 1px dashed var(--brand-gold-light);
            border-radius: var(--radius-small);
            margin-bottom: 1rem;
        }
        .address-details-group label {
           font-weight: 600;
           font-size: 0.9em;
           color: var(--text-light); /* Light text on dark bg */
           margin-bottom: 0.3rem;
           display: block;
        }
        .address-details-group input[type="text"] {
            width: 100%;
            margin-bottom: 0.5rem;
            padding: 0.7rem; /* Increased padding */
            border: 1px solid var(--brand-gold-transparent);
            border-radius: var(--radius-small);
            font-size: 0.95em;
            background-color: rgba(255,255,255,0.1); /* Slightly transparent white */
            color: var(--text-light);
        }
        .address-details-group input[type="text"]::placeholder {
            color: #aaa;
            font-style: italic;
        }
        .small-button {
            padding: 0.5rem 1rem;
            font-size: 0.9em;
        }
        .leaflet-control-layers {
            background: rgba(20, 20, 20, 0.9); /* Dark background for layer control */
            border-radius: 5px;
            box-shadow: 0 1px 5px rgba(0,0,0,0.4);
            padding: 6px 8px;
            border: 1px solid var(--brand-gold-transparent);
        }
        .leaflet-control-layers-base label {
             display: flex;
             align-items: center;
             margin-bottom: 4px;
             color: var(--text-light); /* Light text for labels */
        }
         .leaflet-control-layers-base label span {
            margin-right: 6px; /* RTL adjustment */
         }
         /* Initial screen and selection styling */
        .selection-screen {
            padding: 40px 20px;
            text-align: center;
            min-height: 70vh;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }
        .selection-title {
            font-family: 'Marhey', cursive;
            font-size: 2.8rem;
            color: var(--brand-gold);
            margin-bottom: 1rem;
            text-shadow: 1px 1px 3px rgba(0,0,0,0.5);
        }
        .selection-subtitle {
            font-size: 1.2rem;
            color: var(--text-grey-light);
            margin-bottom: 2.5rem;
        }
        .selection-options {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            justify-content: center;
            margin-bottom: 2rem;
        }
        .option-button {
            font-family: 'Tajawal', sans-serif;
            background-color: transparent;
            color: var(--brand-gold);
            border: 2px solid var(--brand-gold);
            padding: 15px 30px;
            font-size: 1.3rem;
            font-weight: 700;
            border-radius: var(--radius-medium);
            cursor: pointer;
            transition: all 0.3s ease;
            min-width: 180px;
        }
        .option-button:hover, .option-button.selected {
            background-color: var(--brand-gold);
            color: var(--background-dark);
            box-shadow: 0 0 15px var(--brand-gold-transparent);
        }
        .product-display-area {
            padding: 30px 15px;
            text-align: center;
        }
        .product-grid { /* Re-using for consistency with script */
             /* Styles from Vibe Treats product grid, themed for gold/black */
             display: grid;
             grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
             gap: 2rem; /* Increased gap */
        }
        .product-card { /* Styles from Vibe Treats, themed for gold/black */
            background-color: var(--surface-color); /* Slightly lighter than main bg */
            border-radius: var(--radius-large);
            overflow: hidden;
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.3);
            transition: transform 0.3s ease-out, box-shadow 0.3s ease-out;
            border: 1px solid var(--brand-gold-transparent);
            display: flex;
            flex-direction: column;
        }
        .product-card:hover {
            transform: translateY(-10px) scale(1.02);
            box-shadow: 0 12px 30px var(--brand-gold-transparent);
        }
        /* More card styles in style.css */
        .loading-msg, .empty-message {
            color: var(--text-grey-light);
            font-size: 1.2rem;
            padding: 20px;
            text-align: center;
            grid-column: 1 / -1; /* Span full width if grid is empty */
        }
    </style>
</head>
<body class="dark-theme">

    <header class="site-header">
        <div class="container header-container">
            <div class="logo-area">
                <!-- ** IMAGE PROMPT: Atyab El Thamar Logo **
                Design: Elegant, minimalist logo for "أطيب الثمر" (Atyab El Thamar).
                Elements: Abstract representation of a date fruit or date palm, stylized Arabic calligraphy of "أطيب الثمر".
                Color: Predominantly metallic gold (Hex: #DAA520 or #B08D57) with possibly black or deep brown accents.
                Style: Luxurious, premium, modern yet timeless. Suitable for a high-end brand.
                Output: PNG with transparent background. File name: atyab-logo-gold.png
                -->
                <img src="atyab-logo-gold.png" alt="شعار أطيب الثمر" class="logo-main">
            </div>
            <nav class="main-nav" aria-label="القائمة الرئيسية">
                <a href="#how-to-order" class="nav-link">كيف تطلب؟</a>
                <a href="#about-us" class="nav-link">عن تمورنا</a>
            </nav>
            <button id="cart-button" class="cart-toggle-button button-style-primary">
                🛒 السلة (<span id="cart-count">0</span>)
            </button>
            <button class="mobile-menu-toggle" aria-label="فتح/إغلاق القائمة">☰</button>
        </div>
    </header>

    <main>
        <!-- Screen 1: Choose Date Size -->
        <section id="date-size-selection-screen" class="selection-screen active-screen">
            <!-- ** BACKGROUND IMAGE PROMPT: Hero Background Gold Ripples **
            Design: Abstract, luxurious background.
            Elements: Subtle, elegant, flowing ripples or waves of molten gold.
            Color: Shades of metallic gold (#DAA520, #B08D57, #CFB53B) on a deep, rich black or very dark charcoal background.
            Texture: Slightly textured feel for the black, smooth metallic for the gold.
            Lighting: Soft, diffuse lighting that makes the gold shimmer.
            Mood: Premium, sophisticated, opulent, subtly dynamic.
            Usage: Full-screen background image. File name: gold-ripple-background.jpg
            -->
            <h1 class="selection-title">أطيب الثمر</h1>
            <p class="selection-subtitle">جودة تليق بك، اختر الحجم الذي تفضله لتبدأ.</p>
            <div class="selection-options">
                <button class="option-button" data-size="صغير">صغير</button>
                <button class="option-button" data-size="وسط">وسط</button>
                <button class="option-button" data-size="چامبو">چامبو</button>
            </div>
            <p class="info-text" style="color: var(--text-grey-light); margin-top: 2rem;">تمورنا طبيعية ١٠٠٪ وعضوية، مختارة بعناية من أجود المزارع.</p>
        </section>

        <!-- Screen 2: Choose Pack Weight -->
        <section id="pack-weight-selection-screen" class="selection-screen" style="display: none;">
            <h2 class="selection-title">اختر حجم العبوة</h2>
            <p class="selection-subtitle">تمور <span id="selected-date-size-display"></span> فاخرة، جاهزة لتستمتع بها.</p>
            <div class="selection-options">
                <button class="option-button" data-weight="400">عبوة ٤٠٠ جم</button>
                <button class="option-button" data-weight="800">عبوة ٨٠٠ جم</button>
            </div>
            <button id="back-to-size-selection" class="cta-button secondary" style="margin-top: 2rem;">العودة لاختيار الحجم</button>
        </section>

        <!-- Screen 3: Product Display & Add to Cart -->
        <section id="product-display-screen" class="product-display-area" style="display: none;">
            <h2 class="selection-title">طلبك جاهز تقريبًا!</h2>
            <p class="selection-subtitle" id="final-product-selection-info">ستظهر هنا تفاصيل المنتج المختار.</p>
            <div id="product-grid" class="product-grid">
                 <p class="loading-msg" id="loading-indicator">جاري تحميل المنتجات... الرجاء الانتظار لحظات.</p>
                <!-- Products for the selected size & weight will load here -->
            </div>
             <button id="back-to-weight-selection" class="cta-button secondary" style="margin-top: 2rem;">العودة لاختيار الوزن</button>
        </section>


        <section id="how-to-order" class="info-section container">
            <h2 class="section-title">خطوات بسيطة لطلب تمورك الفاخرة</h2>
            <ol class="steps-list">
                <li>اختر حجم التمر المفضل لديك (صغير، وسط، أو چامبو).</li>
                <li>حدد وزن العبوة (٤٠٠ جم أو ٨٠٠ جم).</li>
                <li>تصفح أنواع التمور المتاحة وأضفها إلى السلة.</li>
                <li>أكمل بياناتك، حدد موقعك على الخريطة، واختر طريقة الدفع.</li>
                <li>استمتع بأطيب ثمر يصلك حتى باب بيتك!</li>
            </ol>
        </section>

        <section id="about-us" class="info-section dark-section">
            <div class="container">
            <h2 class="section-title">عن أطيب الثمر</h2>
            <p class="section-subtitle">في أطيب الثمر، نؤمن بأن الجودة هي أساس كل شيء. تمورنا ليست مجرد فاكهة، بل هي تجربة غنية بالنكهات الطبيعية والفوائد الصحية. نحرص على اختيار كل حبة تمر بعناية فائقة من مزارع عضوية، لنضمن لك منتجًا طبيعيًا ١٠٠٪، خاليًا من أي إضافات.</p>
            <p>سواء كنت تبحث عن مصدر طبيعي للطاقة، هدية فاخرة، أو إضافة صحية لنظامك الغذائي، تمور أطيب الثمر هي خيارك الأمثل. نقدم تشكيلة متنوعة تناسب جميع الأذواق، مع التزامنا بأعلى معايير الجودة من المزرعة حتى تصل إليك.</p>
             <!-- ** IMAGE PROMPT: Assorted Premium Dates Display **
            Design: Elegant flat lay or slightly angled shot of assorted premium dates.
            Elements: Various types of dates (e.g., Medjoul, Sukkari, Ajwa if applicable) arranged artfully on a dark, luxurious surface (like slate, dark wood, or rich fabric). Some dates could be whole, some cut open to show texture. Perhaps a few date palm leaves or traditional Arabic elements subtly in the background.
            Color: Rich browns, ambers, and deep reds of the dates, contrasting with the dark background. Gold accents (perhaps a small gold dish or scattered gold flecks) can be present.
            Lighting: Soft, directional lighting that highlights the glossiness and texture of the dates.
            Mood: Luxurious, abundant, healthy, premium quality.
            Usage: An illustrative image for "About Us" or a general gallery. File name: premium-dates-assortment.jpg
            -->
            <img src="premium-dates-assortment.jpg" alt="تشكيلة من تمور أطيب الثمر الفاخرة" class="info-image" style="max-width: 400px; margin: 1.5rem auto; border-radius: var(--radius-medium); border: 2px solid var(--brand-gold-transparent);">
            </div>
        </section>

    </main>

    <footer class="site-footer">
        <div class="container">
            <p class="copyright">© <span id="year">2024</span> أطيب الثمر. جميع الحقوق محفوظة.</p>
            <p class="footer-tagline">تمور طبيعية فاخرة، صنعت بحب.</p>
             <a href="admin-login.html" class="admin-secret-link" target="_blank" title="Admin Zone">👨‍💻</a>
        </div>
    </footer>

    <!-- Cart Sidebar & Overlay (Mostly same as Vibe Treats, translated and themed) -->
    <div id="cart-overlay" class="cart-overlay"></div>
    <div id="cart-sidebar" class="cart-sidebar">
        <button id="close-cart-button" class="close-modal-button" aria-label="إغلاق السلة">×</button>
        <h2 class="sidebar-title">سلة مشترياتك</h2>
        <div id="cart-items" class="cart-items-container">
            <p class="cart-empty-message">سلتك فارغة حاليًا. ابدأ باختيار تمورك المفضلة!</p>
        </div>
        <div class="cart-summary-section">
            <p class="cart-total-text">الإجمالي: <span id="cart-total-price">٠٫٠٠ ج.م</span></p>
            <button id="checkout-button" class="cta-button checkout-btn" disabled>إتمام الطلب</button>
        </div>
    </div>

    <!-- Checkout Modal & Overlay (Mostly same as Vibe Treats, translated and themed) -->
    <div id="checkout-overlay" class="checkout-overlay">
        <div id="checkout-modal" class="checkout-modal">
            <button id="close-checkout-button" class="close-modal-button" aria-label="إغلاق نافذة الطلب">×</button>
            <h2 class="modal-title">تفاصيل الطلب والدفع</h2>

            <form id="checkout-form" novalidate>
                <div class="form-group">
                    <label for="customer_name">الاسم الكريم:</label>
                    <input type="text" id="customer_name" name="customer_name" placeholder="الاسم ثنائي أو ثلاثي" required>
                </div>

                <div class="form-group">
                    <label for="customer_phone">رقم الهاتف:</label>
                    <input type="tel" id="customer_phone" name="customer_phone" placeholder="٠١XXXXXXXXX" required pattern="^01[0-2,5]{1}[0-9]{8}$">
                    <small class="form-hint">هام للتواصل وتأكيد التوصيل.</small>
                </div>

                <div class="form-group">
                     <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.5rem; flex-wrap: wrap; gap: 10px;">
                        <label for="map-container" style="margin-bottom: 0;">موقع التوصيل (حدد على الخريطة أو ابحث):</label>
                        <button type="button" id="find-me-button" class="button-style-secondary small-button" title="تحديد موقعي الحالي">
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" width="16" height="16" style="vertical-align: middle; margin-left: 4px;"><path d="M12 8c-2.21 0-4 1.79-4 4s1.79 4 4 4 4-1.79 4-4-1.79-4-4-4zm8.94 3A8.994 8.994 0 0 0 13 3.06V1h-2v2.06A8.994 8.994 0 0 0 3.06 11H1v2h2.06A8.994 8.994 0 0 0 11 20.94V23h2v-2.06A8.994 8.994 0 0 0 20.94 13H23v-2h-2.06zM12 19c-3.87 0-7-3.13-7-7s3.13-7 7-7 7 3.13 7 7-3.13 7-7 7z"/></svg>
                             حدد موقعي
                        </button>
                    </div>
                    <p style="font-size: 0.85em; margin-bottom: 0.5rem; color: var(--text-grey-light);">
                        استخدم عرض القمر الصناعي (أعلى يمين الخريطة) لرؤية المباني! اضغط على الخريطة، ابحث، أو استخدم 'حدد موقعي'.
                        <strong style="color: var(--brand-gold-light); display: block; margin-top: 3px;">📍 التوصيل حاليًا في <strong style="text-decoration: underline;">القاهرة الكبرى</strong> و<strong style="text-decoration: underline;">الجيزة</strong>.</strong>
                    </p>
                    <div id="map-container" class="map-container" style="height: 300px; width: 100%; margin-bottom: 1rem; border: 1px solid var(--brand-gold-transparent); border-radius: var(--radius-small); background-color: #333; position: relative;">
                        <p style="text-align:center; padding-top: 50px; color: #888; position: absolute; top: 0; right: 0; width: 100%; z-index: 0;">جاري تحميل الخريطة...</p>
                    </div>
                    <p id="location-status" class="status-pending" style="text-align: center; font-weight: bold; min-height: 1.5em; margin-bottom: 1rem;">الرجاء تحديد موقعك على الخريطة أو البحث.</p>
                    <input type="hidden" id="customer_latitude" name="customer_latitude" required>
                    <input type="hidden" id="customer_longitude" name="customer_longitude" required>
                </div>

                <div class="form-group address-details-group">
                    <h4 style="margin-bottom: 0.75rem; font-size: 1rem; color: var(--brand-gold-light);">ساعد مندوب التوصيل (اختياري لكن مفيد):</h4>
                    <label for="building_details">اسم/رقم المبنى/الفيلا:</label>
                    <input type="text" id="building_details" name="building_details" placeholder="مثال: فيلا ١٢٣، عمارة ٧أ">
                    <label for="floor_apt">رقم الدور والشقة (إن وجد):</label>
                    <input type="text" id="floor_apt" name="floor_apt" placeholder="مثال: الدور ٣، شقة ٣٠٢">
                    <label for="landmarks">علامات مميزة / ملاحظات للمندوب:</label>
                    <input type="text" id="landmarks" name="landmarks" placeholder="مثال: بجوار مسجد الرحمن، الاتصال عند الوصول">
                </div>

                <div class="checkout-summary-box">
                    <h4 class="summary-title" style="font-size: 1.1rem; margin-bottom: 0.5rem;">ملخص الطلب:</h4>
                    <div id="checkout-summary" style="max-height: 80px; overflow-y: auto;">
                        <p style="font-style: italic; color: var(--text-grey-light); font-size: 0.9rem;">محتويات السلة تظهر هنا...</p>
                    </div>
                    <p class="total-title" style="margin-top: 0.5rem; font-size: 1.2rem;">الإجمالي: <span id="checkout-total-price">٠٫٠٠ ج.م</span></p>
                </div>
                
                <!-- Payment Info. Use appropriate Egyptian payment gateway or cash. Keeping Telda/Instapay as placeholders -->
                 <div class="telda-payment-instructions">
                    <!-- ** IMAGE PROMPT: Telda Logo for Dark Theme **
                    Design: Telda app logo.
                    Color: Original Telda colors, ensure good contrast if possible on a dark background or use a version with a light outline/background if Telda provides one.
                    Output: PNG. File name: telda-logo-dark.png
                    -->
                    <img src="telda-logo-dark.png" alt="شعار تلدا" class="telda-logo"> <!-- Create or find Telda logo for dark theme -->
                    <h4>الدفع عبر Telda (اختياري)</h4>
                    <p>أرسل إجمالي المبلغ (<span id="telda-total-price-reminder" class="payment-total-reminder">٠٫٠٠ ج.م</span>) عبر تطبيق تلدا إلى:</p>
                    <p class="telda-username-wrapper">
                        <span class="telda-username">@AtyabElThamar</span> <!-- EXAMPLE USERNAME -->
                    </p>
                </div>

                <div class="instapay-payment-instructions">
                    <!-- ** IMAGE PROMPT: Instapay Logo for Dark Theme **
                    Design: Instapay app logo.
                    Color: Original Instapay colors, ensure good contrast for dark theme or use a white/light version.
                    Output: PNG. File name: instapay-logo-dark.png
                    -->
                    <img src="instapay-logo-dark.png" alt="شعار إنستاباي" class="instapay-logo"> <!-- Create or find Instapay logo -->
                    <h4>الدفع عبر InstaPay (اختياري)</h4>
                    <p>أو أرسل إجمالي المبلغ (<span id="instapay-total-price-reminder" class="payment-total-reminder">٠٫٠٠ ج.م</span>) عبر تطبيق إنستاباي:</p>
                    <div class="copyable-detail">
                        <label>رقم الحساب/الهاتف:</label>
                        <span class="instapay-detail" id="instapay-account">01xxxxxxxxx / اسم الحساب</span>
                        <button type="button" class="copy-button" data-clipboard-target="#instapay-account" aria-label="نسخ رقم الحساب">📋 نسخ</button>
                    </div>
                </div>

                <div class="form-group payment-method-selection">
                    <label>اختر طريقة الدفع التي استخدمتها أو ستستخدمها:*</label>
                    <div class="payment-method-options">
                        <div>
                            <input type="radio" id="payment-method-telda" name="payment_method" value="Telda" required>
                            <label for="payment-method-telda">Telda</label>
                        </div>
                        <div>
                            <input type="radio" id="payment-method-instapay" name="payment_method" value="Instapay" required>
                            <label for="payment-method-instapay">InstaPay</label>
                        </div>
                        <div>
                            <input type="radio" id="payment-method-cash" name="payment_method" value="CashOnDelivery" required>
                            <label for="payment-method-cash">الدفع عند الاستلام</label>
                        </div>
                    </div>
                </div>

                <button type="submit" id="submit-order-button" class="cta-button submit-btn">تأكيد الطلب وإرسال التفاصيل</button>
                <p id="checkout-message" class="checkout-message"></p>
            </form>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>
    <script src="https://unpkg.com/leaflet-control-geocoder/dist/Control.Geocoder.js"></script>
    <script src="script.js"></script>
</body>
</html>